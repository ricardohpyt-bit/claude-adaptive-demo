<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Constitutional Design for UI - Claude Adaptive Demo</title>
  <meta name="description" content="An interactive prototype demonstrating how Claude could adapt its interface based on user learning styles.">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f5f5f5; }
    #root { width: 100%; height: 100vh; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .loading { display: flex; align-items: center; justify-content: center; height: 100vh; font-size: 18px; color: #666; }
  </style>
</head>
<body>
  <div id="root"><div class="loading">Loading demo...</div></div>
  
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  
  <script>
    // Wait for React to load
    function initApp() {
      if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
        setTimeout(initApp, 100);
        return;
      }
      
      const e = React.createElement;
      const useState = React.useState;

      const colors = {
        bgPrimary: '#FAF9F7', bgSidebar: '#F5F4F0', textPrimary: '#1A1915',
        textSecondary: '#6B6760', textMuted: '#9B9690', accent: '#D97757',
        borderLight: '#E8E6E1', borderMedium: '#D4D2CD', userBubble: '#F0EFEB',
        blue: '#3B82F6', purple: '#8B5CF6', green: '#22C55E'
      };

      // Icons as simple SVGs
      const Icons = {
        Claude: ({size = 20}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none'},
          e('path', {d: 'M12 2L13.09 8.26L18 6L14.74 10.91L21 12L14.74 13.09L18 18L13.09 15.74L12 22L10.91 15.74L6 18L9.26 13.09L3 12L9.26 10.91L6 6L10.91 8.26L12 2Z', fill: colors.accent})
        ),
        Send: ({size = 16, color = '#fff'}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth: 2},
          e('line', {x1: 22, y1: 2, x2: 11, y2: 13}), e('polygon', {points: '22 2 15 22 11 13 2 9 22 2'})
        ),
        Plus: ({size = 15}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('line', {x1: 12, y1: 5, x2: 12, y2: 19}), e('line', {x1: 5, y1: 12, x2: 19, y2: 12})
        ),
        Zap: ({size = 16, color}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth: 2},
          e('polygon', {points: '13 2 3 14 12 14 11 22 21 10 12 10 13 2'})
        ),
        Layers: ({size = 12}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('polygon', {points: '12 2 2 7 12 12 22 7 12 2'}), e('polyline', {points: '2 17 12 22 22 17'}), e('polyline', {points: '2 12 12 17 22 12'})
        ),
        Info: ({size = 12}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('circle', {cx: 12, cy: 12, r: 10}), e('line', {x1: 12, y1: 16, x2: 12, y2: 12}), e('line', {x1: 12, y1: 8, x2: 12.01, y2: 8})
        ),
        ChevronRight: ({size = 12}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('polyline', {points: '9 18 15 12 9 6'})
        ),
        ChevronDown: ({size = 12}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('polyline', {points: '6 9 12 15 18 9'})
        ),
        Lightbulb: ({size = 18}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('path', {d: 'M9 18h6'}), e('path', {d: 'M10 22h4'}), e('path', {d: 'M12 2a7 7 0 0 0-4 12.7V17h8v-2.3A7 7 0 0 0 12 2z'})
        ),
        ArrowRight: ({size = 10}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('line', {x1: 5, y1: 12, x2: 19, y2: 12}), e('polyline', {points: '12 5 19 12 12 19'})
        ),
        Compass: ({size = 10}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('circle', {cx: 12, cy: 12, r: 10}), e('polygon', {points: '16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76'})
        ),
        ArrowUpRight: ({size = 10}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('line', {x1: 7, y1: 17, x2: 17, y2: 7}), e('polyline', {points: '7 7 17 7 17 17'})
        ),
        Image: ({size = 10}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('rect', {x: 3, y: 3, width: 18, height: 18, rx: 2}), e('circle', {cx: 8.5, cy: 8.5, r: 1.5}), e('polyline', {points: '21 15 16 10 5 21'})
        ),
        FileText: ({size = 10}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('path', {d: 'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z'}), e('polyline', {points: '14 2 14 8 20 8'}), e('line', {x1: 16, y1: 13, x2: 8, y2: 13}), e('line', {x1: 16, y1: 17, x2: 8, y2: 17})
        ),
        Code: ({size = 10}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('polyline', {points: '16 18 22 12 16 6'}), e('polyline', {points: '8 6 2 12 8 18'})
        ),
        X: ({size = 14}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('line', {x1: 18, y1: 6, x2: 6, y2: 18}), e('line', {x1: 6, y1: 6, x2: 18, y2: 18})
        )
      };

      function FeasibilityBadge({level, glow = true}) {
        const [showTip, setShowTip] = useState(false);
        const configs = {
          now: { label: 'Buildable now', color: colors.green, tooltip: "Can be implemented today using Claude's existing memory system." },
          near: { label: 'Near-term', color: colors.blue, tooltip: 'Achievable with current artifact capabilities plus UI work.' },
          future: { label: 'Future vision', color: colors.purple, tooltip: 'Requires new infrastructure and platform integration.' }
        };
        const c = configs[level];
        return e('span', {
          style: {position: 'relative', display: 'inline-flex', zIndex: 100},
          onMouseEnter: () => setShowTip(true), onMouseLeave: () => setShowTip(false)
        },
          e('span', {style: {fontSize: 9, fontWeight: 600, padding: '3px 7px', borderRadius: 4, backgroundColor: '#fff', color: c.color, textTransform: 'uppercase', letterSpacing: '0.3px', cursor: 'help', border: '2px solid ' + c.color, boxShadow: glow ? '0 0 12px ' + c.color + '60' : 'none'}}, c.label),
          showTip && e('span', {style: {position: 'absolute', bottom: '100%', left: '50%', transform: 'translateX(-50%)', marginBottom: 8, padding: '10px 12px', backgroundColor: '#1a1a1a', color: '#fff', fontSize: 11, lineHeight: 1.5, borderRadius: 8, width: 200, textAlign: 'left', zIndex: 1000}},
            e('span', {style: {fontWeight: 600, color: c.color, display: 'block', marginBottom: 4}}, c.label), c.tooltip
          )
        );
      }

      function Beacons({drillDown = [], sideways = [], broaden = [], onSelect}) {
        const items = [
          ...drillDown.map(t => ({text: t, color: colors.blue, icon: e(Icons.ArrowRight, {size: 10})})),
          ...sideways.map(t => ({text: t, color: colors.purple, icon: e(Icons.Compass, {size: 10})})),
          ...broaden.map(t => ({text: t, color: colors.green, icon: e(Icons.ArrowUpRight, {size: 10})}))
        ];
        if (!items.length) return null;
        return e('div', {style: {marginTop: 16, padding: 14, backgroundColor: colors.bgSidebar, borderRadius: 12, border: '1px solid ' + colors.borderLight}},
          e('div', {style: {fontSize: 11, fontWeight: 600, color: colors.textMuted, textTransform: 'uppercase', letterSpacing: 0.5, marginBottom: 10}}, 'Continue exploring'),
          e('div', {style: {display: 'flex', gap: 8, flexWrap: 'wrap'}},
            items.map((item, i) => e('button', {
              key: i, onClick: () => onSelect(item.text),
              style: {display: 'flex', alignItems: 'center', gap: 5, padding: '6px 12px', backgroundColor: '#fff', border: '1px solid ' + item.color + '40', borderRadius: 20, cursor: 'pointer', fontSize: 12, color: colors.textPrimary, fontFamily: 'inherit'}
            }, e('span', {style: {color: item.color}}, item.icon), item.text))
          )
        );
      }

      function WelcomeScreen({onSelectPrompt, persona}) {
        const names = {maya: 'Maya', james: 'James', alex: 'Alex'};
        const greetings = {maya: 'Ready to visualize something?', james: 'Ready to explore ideas in depth?', alex: 'Ready to build something?'};
        return e('div', {style: {display: 'flex', flexDirection: 'column', alignItems: 'center', padding: 32}},
          e(Icons.Claude, {size: 48}),
          e('h1', {style: {fontSize: 28, fontWeight: 600, color: colors.textPrimary, marginTop: 16, marginBottom: 8}}, 'Good afternoon, ' + names[persona]),
          e('p', {style: {fontSize: 16, color: colors.textSecondary, maxWidth: 400, textAlign: 'center', marginBottom: 32}}, greetings[persona]),
          e('button', {
            onClick: () => onSelectPrompt('Explain how large language models work'),
            style: {display: 'flex', alignItems: 'center', gap: 12, padding: 16, backgroundColor: '#fff', border: '1px solid ' + colors.borderLight, borderRadius: 12, cursor: 'pointer', textAlign: 'left', fontFamily: 'inherit', maxWidth: 300}
          },
            e('div', {style: {color: colors.accent}}, e(Icons.Lightbulb, {size: 18})),
            e('div', null,
              e('div', {style: {fontSize: 10, fontWeight: 600, color: colors.textMuted, textTransform: 'uppercase'}}, 'Learn'),
              e('div', {style: {fontSize: 14, color: colors.textPrimary, marginTop: 4}}, 'Explain how large language models work')
            )
          )
        );
      }

      function InputBar({persona, onSend, value, setValue}) {
        const placeholders = {maya: 'Describe what you want to visualize...', james: 'What would you like to explore?', alex: 'What do you want to build?'};
        return e('div', {style: {padding: '12px 24px 16px', borderTop: '1px solid ' + colors.borderLight, backgroundColor: colors.bgPrimary}},
          e('div', {style: {display: 'flex', alignItems: 'center', gap: 12, backgroundColor: '#fff', border: '1px solid ' + colors.borderMedium, borderRadius: 24, padding: '8px 8px 8px 20px'}},
            e('input', {type: 'text', value: value, onChange: ev => setValue(ev.target.value), placeholder: placeholders[persona], style: {flex: 1, border: 'none', outline: 'none', fontSize: 15, color: colors.textPrimary, backgroundColor: 'transparent', fontFamily: 'inherit'}, onKeyDown: ev => { if (ev.key === 'Enter' && value.trim()) onSend(value); }}),
            e('button', {onClick: () => value.trim() && onSend(value), style: {width: 36, height: 36, borderRadius: '50%', border: 'none', backgroundColor: value.trim() ? colors.accent : colors.borderLight, display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer'}},
              e(Icons.Send, {size: 16, color: value.trim() ? '#fff' : colors.textMuted})
            )
          )
        );
      }

      function ResponseHeader({persona, showReasoning, onToggle, showMvp}) {
        const reasoning = {
          maya: {short: 'Visual learner â†’ Interactive diagram', memory: 'Prefers diagrams and visual explanations.', rule: 'if (user.learningStyle === "visual") â†’ format = "diagram"'},
          james: {short: 'Deep reader â†’ Structured prose', memory: 'Prefers comprehensive written explanations.', rule: 'if (user.learningStyle === "reading") â†’ format = "prose"'},
          alex: {short: 'Hands-on â†’ Step-by-step tutorial', memory: 'Learns by doing with interactive tutorials.', rule: 'if (user.learningStyle === "kinesthetic") â†’ format = "tutorial"'}
        };
        const r = reasoning[persona];
        return e('div', {style: {marginBottom: 16}},
          e('div', {style: {display: 'flex', alignItems: 'center', gap: 8, marginBottom: showReasoning ? 12 : 0, flexWrap: 'wrap'}},
            e('span', {style: {fontSize: 12, fontWeight: 500, color: colors.textSecondary}}, 'Claude'),
            e('button', {onClick: onToggle, style: {display: 'flex', alignItems: 'center', gap: 4, padding: '3px 8px', backgroundColor: showReasoning ? colors.purple + '15' : 'transparent', border: '1px solid ' + (showReasoning ? colors.purple : colors.borderLight), borderRadius: 12, cursor: 'pointer', fontFamily: 'inherit', fontSize: 11, color: showReasoning ? colors.purple : colors.textMuted}},
              e(Icons.Info, {size: 12}), ' Why this format?', showReasoning ? e(Icons.ChevronDown, {size: 12}) : e(Icons.ChevronRight, {size: 12})
            ),
            !showReasoning && e('span', {style: {fontSize: 11, color: colors.textMuted, fontStyle: 'italic'}}, r.short),
            showMvp && !showReasoning && e(FeasibilityBadge, {level: 'now'})
          ),
          showReasoning && e('div', {style: {backgroundColor: colors.bgSidebar, borderRadius: 12, padding: 16, border: '1px solid ' + colors.borderLight}},
            e('div', {style: {marginBottom: 12}},
              e('div', {style: {display: 'flex', alignItems: 'center', gap: 6, marginBottom: 6}},
                e('div', {style: {width: 6, height: 6, borderRadius: '50%', backgroundColor: colors.accent}}),
                e('span', {style: {fontSize: 11, fontWeight: 600, color: colors.textSecondary, textTransform: 'uppercase'}}, "Claude's Memory"),
                showMvp && e(FeasibilityBadge, {level: 'now'})
              ),
              e('p', {style: {margin: 0, fontSize: 13, color: colors.textPrimary, paddingLeft: 12}}, r.memory)
            ),
            e('div', null,
              e('div', {style: {display: 'flex', alignItems: 'center', gap: 6, marginBottom: 6}},
                e('div', {style: {width: 6, height: 6, borderRadius: '50%', backgroundColor: colors.purple}}),
                e('span', {style: {fontSize: 11, fontWeight: 600, color: colors.textSecondary, textTransform: 'uppercase'}}, 'UI Constitution Rule'),
                showMvp && e(FeasibilityBadge, {level: 'now'})
              ),
              e('pre', {style: {margin: 0, fontSize: 11, color: '#E8E6E1', backgroundColor: '#2D2D2D', padding: 12, borderRadius: 8, overflow: 'auto'}}, r.rule)
            )
          )
        );
      }

      function MayaResponse({onFollowUp, showMvp}) {
        const [active, setActive] = useState(null);
        const stages = [
          {id: 'input', label: 'Input', color: colors.blue, desc: 'Text arrives as characters'},
          {id: 'tokenize', label: 'Tokenize', color: colors.purple, desc: 'Text splits into tokens'},
          {id: 'embed', label: 'Embed', color: colors.purple, desc: 'Tokens become vectors'},
          {id: 'attention', label: 'Attention', color: colors.purple, desc: '96 layers learn relationships'},
          {id: 'output', label: 'Output', color: colors.green, desc: 'Model predicts next token'}
        ];
        return e('div', null,
          e('div', {style: {display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12}},
            e('p', {style: {margin: 0, color: colors.textSecondary}}, "Here's how your words flow through an LLM â€” tap any stage:"),
            showMvp && e(FeasibilityBadge, {level: 'near'})
          ),
          e('div', {style: {background: 'linear-gradient(180deg, #FAFBFC, #F5F7FA)', borderRadius: 16, border: '1px solid #E5E7EB', padding: 20, marginBottom: 16}},
            stages.map((s, i) => e('div', {key: s.id},
              e('div', {
                onClick: () => setActive(active === s.id ? null : s.id),
                style: {padding: '12px 14px', marginBottom: i < 4 ? 8 : 0, background: 'linear-gradient(135deg, ' + s.color + '08, ' + s.color + '15)', border: '2px solid ' + (active === s.id ? s.color : s.color + '40'), borderRadius: 12, cursor: 'pointer'}
              },
                e('div', {style: {display: 'flex', alignItems: 'center', gap: 10}},
                  e('div', {style: {width: 32, height: 32, borderRadius: 8, background: s.color, display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff', fontSize: 14, fontWeight: 600}}, i + 1),
                  e('div', null,
                    e('div', {style: {fontSize: 12, fontWeight: 600, color: s.color, textTransform: 'uppercase'}}, s.label),
                    e('div', {style: {fontSize: 12, color: colors.textSecondary}}, s.desc)
                  )
                )
              )
            ))
          ),
          e(Beacons, {drillDown: ['Attention mechanism deep-dive'], sideways: ['How does this compare to human cognition?'], onSelect: onFollowUp})
        );
      }

      function JamesResponse({onFollowUp, showMvp}) {
        return e('div', null,
          e('p', {style: {marginBottom: 16, color: colors.textPrimary, lineHeight: 1.8}},
            'Large Language Models represent a fundamental shift in AI. Rather than programming explicit rules, we train neural networks on vast text corpora to predict and generate language.'
          ),
          e('div', {style: {display: 'flex', alignItems: 'center', gap: 8, marginBottom: 16}},
            e('span', {style: {color: colors.accent, fontSize: 12, fontWeight: 600}}, 'ðŸ’¡ Interactive glossary available'),
            showMvp && e(FeasibilityBadge, {level: 'near'})
          ),
          e('h3', {style: {fontSize: 14, fontWeight: 600, color: colors.textPrimary, marginBottom: 8}}, '1. The Core Architecture'),
          e('p', {style: {marginBottom: 16, color: colors.textPrimary, lineHeight: 1.8}},
            'Modern LLMs are built on the transformer architecture, using attention mechanisms to process all tokens in parallel.'
          ),
          e('div', {style: {borderLeft: '3px solid ' + colors.accent, backgroundColor: colors.accent + '08', padding: '14px 18px', borderRadius: '0 8px 8px 0', marginBottom: 16}},
            e('p', {style: {margin: 0, fontStyle: 'italic', color: colors.textSecondary}},
              e('strong', {style: {color: colors.textPrimary}}, 'Key insight: '),
              "LLMs are sophisticated pattern matchers. They predict likely continuations based on statistical patterns."
            )
          ),
          e(Beacons, {drillDown: ['Explain attention in depth'], sideways: ["What can't LLMs do?"], onSelect: onFollowUp})
        );
      }

      function AlexResponse({onFollowUp, showMvp}) {
        const [input, setInput] = useState('');
        const [step, setStep] = useState(1);
        const [completed, setCompleted] = useState([]);
        
        const tokens = input ? input.split(/\s+/).filter(x => x) : [];
        const steps = [{n: 1, t: 'Input'}, {n: 2, t: 'Tokenize'}, {n: 3, t: 'Process'}, {n: 4, t: 'Output'}];
        
        const next = () => { if (step < 4) { setCompleted([...completed, step]); setStep(step + 1); }};
        const back = () => { if (step > 1) { setCompleted(completed.filter(s => s !== step - 1)); setStep(step - 1); }};

        return e('div', null,
          e('div', {style: {display: 'flex', alignItems: 'center', gap: 8, marginBottom: 16}},
            e('p', {style: {margin: 0, color: colors.textPrimary}}, "Let's learn by doing. Complete each step."),
            showMvp && e(FeasibilityBadge, {level: 'near'})
          ),
          e('div', {style: {display: 'flex', alignItems: 'center', gap: 4, marginBottom: 16}},
            steps.map((s, i) => e(React.Fragment, {key: s.n},
              e('div', {style: {display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 3}},
                e('div', {style: {width: 24, height: 24, borderRadius: '50%', background: completed.includes(s.n) ? colors.green : step === s.n ? colors.accent : colors.borderLight, color: '#fff', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 11, fontWeight: 600}}, completed.includes(s.n) ? 'âœ“' : s.n),
                e('div', {style: {fontSize: 9, color: step === s.n ? colors.accent : colors.textMuted}}, s.t)
              ),
              i < 3 && e('div', {style: {width: 20, height: 2, background: completed.includes(s.n) ? colors.green : colors.borderLight, marginBottom: 12}})
            ))
          ),
          e('div', {style: {backgroundColor: '#fff', borderRadius: 12, border: '1px solid ' + colors.borderLight, padding: 16, marginBottom: 12}},
            step === 1 && e('div', null,
              e('h4', {style: {margin: '0 0 8px', fontSize: 14}}, 'Step 1: Enter Your Text'),
              e('input', {type: 'text', value: input, onChange: ev => setInput(ev.target.value), placeholder: 'e.g., Hello world!', style: {width: '100%', padding: '10px 12px', fontSize: 14, border: '2px solid ' + colors.borderLight, borderRadius: 8, outline: 'none', boxSizing: 'border-box'}})
            ),
            step === 2 && e('div', null,
              e('h4', {style: {margin: '0 0 8px', fontSize: 14}}, 'Step 2: Tokenization'),
              e('div', {style: {marginBottom: 8, padding: 10, background: colors.bgSidebar, borderRadius: 8}}, '"' + (input || 'Hello world!') + '"'),
              e('div', {style: {display: 'flex', gap: 6, flexWrap: 'wrap'}},
                (tokens.length ? tokens : ['Hello', 'world!']).map((t, i) => e('span', {key: i, style: {padding: '4px 10px', backgroundColor: colors.purple + '15', color: colors.purple, borderRadius: 6, fontSize: 12}}, t))
              )
            ),
            step === 3 && e('div', null,
              e('h4', {style: {margin: '0 0 8px', fontSize: 14}}, 'Step 3: Neural Processing'),
              e('p', {style: {color: colors.textSecondary, fontSize: 13}}, '96 attention layers analyzing relationships...'),
              e('div', {style: {display: 'flex', gap: 4, marginTop: 12}},
                Array(8).fill(0).map((_, i) => e('div', {key: i, style: {width: 24, height: 24, borderRadius: 4, backgroundColor: i < 3 ? colors.accent : colors.borderLight}}))
              )
            ),
            step === 4 && e('div', null,
              e('h4', {style: {margin: '0 0 8px', fontSize: 14}}, 'Step 4: Prediction'),
              e('div', {style: {padding: 12, background: colors.green + '08', borderRadius: 8}},
                ['world (23%)', 'there (18%)', '! (15%)'].map((p, i) => e('div', {key: i, style: {display: 'flex', alignItems: 'center', gap: 8, marginTop: i ? 6 : 0}},
                  e('span', {style: {fontSize: 12, width: 80}}, p),
                  e('div', {style: {flex: 1, height: 6, background: colors.green + '30', borderRadius: 3}},
                    e('div', {style: {width: (23 - i * 5) * 3 + '%', height: '100%', background: colors.green, borderRadius: 3}})
                  )
                ))
              )
            )
          ),
          e('div', {style: {display: 'flex', justifyContent: 'space-between'}},
            e('button', {onClick: back, disabled: step === 1, style: {padding: '8px 12px', borderRadius: 6, border: '1px solid ' + colors.borderLight, background: '#fff', cursor: step === 1 ? 'not-allowed' : 'pointer', opacity: step === 1 ? 0.5 : 1}}, 'â† Back'),
            e('button', {onClick: next, disabled: step === 1 && !input.trim(), style: {padding: '8px 12px', borderRadius: 6, border: 'none', background: (step === 1 && !input.trim()) ? colors.borderLight : colors.accent, color: '#fff', cursor: (step === 1 && !input.trim()) ? 'not-allowed' : 'pointer'}}, step === 4 ? 'Complete!' : 'Next â†’')
          ),
          e(Beacons, {drillDown: ['Build a minimal transformer'], sideways: ['How does fine-tuning work?'], onSelect: onFollowUp})
        );
      }

      function App() {
        const [persona, setPersona] = useState('maya');
        const [view, setView] = useState('welcome');
        const [message, setMessage] = useState('');
        const [inputValue, setInputValue] = useState('');
        const [isLoading, setIsLoading] = useState(false);
        const [showReasoning, setShowReasoning] = useState(false);
        const [showMvp, setShowMvp] = useState(false);
        const [formatOverride, setFormatOverride] = useState(null);

        const personas = [{id: 'maya', name: 'Maya', style: 'Visual'}, {id: 'james', name: 'James', style: 'Reading'}, {id: 'alex', name: 'Alex', style: 'Hands-On'}];
        
        const selectPrompt = text => { setMessage(text); setIsLoading(true); setView('chat'); setFormatOverride(null); setTimeout(() => setIsLoading(false), 1500); };
        const send = text => { setMessage(text); setInputValue(''); setIsLoading(true); setView('chat'); setTimeout(() => setIsLoading(false), 1500); };
        const reset = () => { setView('welcome'); setMessage(''); setInputValue(''); setShowReasoning(false); setFormatOverride(null); };

        const effectiveFormat = formatOverride || (persona === 'maya' ? 'visual' : persona === 'alex' ? 'interactive' : 'text');

        return e('div', {style: {fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif', display: 'flex', height: '100vh', borderRadius: 12, overflow: 'hidden', border: '1px solid ' + colors.borderLight, boxShadow: '0 4px 24px rgba(0,0,0,0.08)', position: 'relative'}},
          
          showMvp && e('div', {onClick: () => setShowMvp(false), style: {position: 'absolute', inset: 0, zIndex: 5, cursor: 'pointer'}}),
          
          // Sidebar
          e('div', {style: {width: 260, flexShrink: 0, display: 'flex', flexDirection: 'column', borderRight: '1px solid ' + colors.borderLight, backgroundColor: colors.bgSidebar, zIndex: 10}},
            e('div', {style: {padding: '14px 18px', display: 'flex', alignItems: 'center', gap: 8, borderBottom: '1px solid ' + colors.borderLight}},
              e(Icons.Claude, {size: 22}),
              e('span', {style: {fontSize: 17, fontWeight: 600, color: colors.textPrimary}}, 'Claude')
            ),
            e('div', {style: {padding: '10px 14px'}},
              e('button', {onClick: reset, style: {width: '100%', padding: '9px 14px', backgroundColor: colors.bgPrimary, border: '1px solid ' + colors.borderLight, borderRadius: 8, display: 'flex', alignItems: 'center', gap: 7, cursor: 'pointer', fontSize: 13, color: colors.textPrimary, fontFamily: 'inherit'}},
                e(Icons.Plus, {size: 15}), 'New chat'
              )
            ),
            e('div', {style: {flex: 1}}),
            
            // Demo Controls
            e('div', {style: {margin: 14, padding: 14, backgroundColor: colors.bgPrimary, borderRadius: 10, border: '1px solid ' + colors.borderLight}},
              e('div', {style: {display: 'flex', alignItems: 'center', gap: 7, marginBottom: 10}},
                e(Icons.Zap, {size: 16, color: colors.accent}),
                e('span', {style: {fontSize: 12, fontWeight: 600, color: colors.textPrimary}}, 'Demo Mode')
              ),
              e('button', {
                onClick: () => setShowMvp(!showMvp),
                style: {width: '100%', padding: '8px 10px', marginBottom: 10, backgroundColor: showMvp ? colors.blue + '15' : 'transparent', border: '1px solid ' + (showMvp ? colors.blue : colors.borderLight), borderRadius: 6, cursor: 'pointer', fontSize: 11, color: showMvp ? colors.blue : colors.textSecondary, fontFamily: 'inherit', display: 'flex', alignItems: 'center', gap: 6}
              }, e(Icons.Layers, {size: 12}), (showMvp ? 'Hide' : 'Show') + ' feasibility'),
              e('div', {style: {fontSize: 11, color: colors.textSecondary, marginBottom: 8}}, 'Switch persona:'),
              e('div', {style: {display: 'flex', flexDirection: 'column', gap: 3}},
                personas.map(p => e('button', {
                  key: p.id, onClick: () => { setPersona(p.id); setFormatOverride(null); },
                  style: {display: 'flex', alignItems: 'center', gap: 9, padding: '9px 10px', borderRadius: 7, border: 'none', backgroundColor: persona === p.id ? colors.accent + '15' : 'transparent', cursor: 'pointer', width: '100%', textAlign: 'left', fontFamily: 'inherit'}
                },
                  e('div', {style: {width: 7, height: 7, borderRadius: '50%', border: '2px solid ' + (persona === p.id ? colors.accent : colors.borderMedium), backgroundColor: persona === p.id ? colors.accent : 'transparent'}}),
                  e('div', null,
                    e('div', {style: {fontSize: 12, fontWeight: persona === p.id ? 600 : 400, color: persona === p.id ? colors.accent : colors.textPrimary}}, p.name),
                    e('div', {style: {fontSize: 10, color: colors.textMuted}}, p.style)
                  )
                ))
              )
            ),
            
            showMvp && e('div', {style: {margin: '0 14px 14px', padding: 12, backgroundColor: '#fff', borderRadius: 8, border: '1px solid ' + colors.borderLight}},
              e('div', {style: {fontSize: 10, fontWeight: 600, color: colors.textMuted, marginBottom: 8, textTransform: 'uppercase'}}, 'Phases'),
              [{l: 'now', t: 'Memory + prompts'}, {l: 'near', t: 'Artifacts + UI'}, {l: 'future', t: 'New infra'}].map(x => 
                e('div', {key: x.l, style: {display: 'flex', alignItems: 'center', gap: 6, marginBottom: 4}},
                  e(FeasibilityBadge, {level: x.l, glow: false}),
                  e('span', {style: {fontSize: 10, color: colors.textSecondary}}, x.t)
                )
              )
            )
          ),

          // Main content
          e('div', {style: {flex: 1, display: 'flex', flexDirection: 'column', backgroundColor: colors.bgPrimary, position: 'relative', zIndex: showMvp ? 6 : 1}},
            showMvp && e('div', {style: {position: 'absolute', inset: 0, backgroundColor: 'rgba(255,255,255,0.6)', zIndex: 8, pointerEvents: 'none'}}),
            
            view === 'welcome' ? e(React.Fragment, null,
              e('div', {style: {flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center'}},
                e(WelcomeScreen, {onSelectPrompt: selectPrompt, persona: persona})
              ),
              e(InputBar, {persona: persona, onSend: send, value: inputValue, setValue: setInputValue})
            ) : e(React.Fragment, null,
              e('div', {style: {flex: 1, overflow: 'auto', padding: '16px 24px'}},
                e('div', {style: {display: 'flex', justifyContent: 'flex-end', marginBottom: 20}},
                  e('div', {style: {maxWidth: '85%', backgroundColor: colors.userBubble, padding: '10px 14px', borderRadius: 14, fontSize: 13, color: colors.textPrimary}}, message)
                ),
                isLoading ? e('div', {style: {display: 'flex', gap: 10}},
                  e('div', {style: {width: 24, height: 24, borderRadius: '50%', backgroundColor: colors.accent + '15', display: 'flex', alignItems: 'center', justifyContent: 'center'}}, e(Icons.Claude, {size: 12})),
                  e('div', {style: {padding: 12, backgroundColor: colors.bgSidebar, borderRadius: 10}},
                    e('span', {style: {fontSize: 12, color: colors.accent}}, 'Thinking...')
                  )
                ) : e('div', {style: {display: 'flex', gap: 10}},
                  e('div', {style: {width: 24, height: 24, borderRadius: '50%', backgroundColor: colors.accent + '15', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0}}, e(Icons.Claude, {size: 12})),
                  e('div', {style: {flex: 1, minWidth: 0}},
                    e(ResponseHeader, {persona: persona, showReasoning: showReasoning, onToggle: () => setShowReasoning(!showReasoning), showMvp: showMvp}),
                    
                    e('div', {style: {display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12, flexWrap: 'wrap'}},
                      e('span', {style: {fontSize: 11, color: colors.textMuted}}, 'Format:'),
                      [{id: 'visual', label: 'Visual', icon: e(Icons.Image, {size: 10})}, {id: 'text', label: 'Text', icon: e(Icons.FileText, {size: 10})}, {id: 'interactive', label: 'Interactive', icon: e(Icons.Code, {size: 10})}].map(f =>
                        e('button', {
                          key: f.id,
                          onClick: () => setFormatOverride(f.id === effectiveFormat && formatOverride ? null : f.id),
                          style: {display: 'flex', alignItems: 'center', gap: 4, padding: '4px 10px', fontSize: 11, border: '1px solid ' + (effectiveFormat === f.id ? colors.accent : colors.borderLight), borderRadius: 12, backgroundColor: effectiveFormat === f.id ? colors.accent + '10' : '#fff', color: effectiveFormat === f.id ? colors.accent : colors.textSecondary, cursor: 'pointer', fontFamily: 'inherit'}
                        }, f.icon, ' ', f.label, effectiveFormat === f.id && !formatOverride && e('span', {style: {fontSize: 9, opacity: 0.7}}, ' (auto)'))
                      ),
                      showMvp && e(FeasibilityBadge, {level: 'now'})
                    ),
                    
                    e('div', {style: {fontSize: 14, lineHeight: 1.7, color: colors.textPrimary}},
                      effectiveFormat === 'visual' && e(MayaResponse, {onFollowUp: t => setInputValue(t), showMvp: showMvp}),
                      effectiveFormat === 'text' && e(JamesResponse, {onFollowUp: t => setInputValue(t), showMvp: showMvp}),
                      effectiveFormat === 'interactive' && e(AlexResponse, {onFollowUp: t => setInputValue(t), showMvp: showMvp})
                    )
                  )
                )
              ),
              e(InputBar, {persona: persona, onSend: send, value: inputValue, setValue: setInputValue})
            )
          )
        );
      }

      ReactDOM.render(e(App), document.getElementById('root'));
    }
    
    // Start the app when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initApp);
    } else {
      initApp();
    }
  </script>
</body>
</html>
