<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Constitutional Design for UI - Claude Adaptive Demo</title>
  <meta name="description" content="An interactive prototype demonstrating how Claude could adapt its interface based on user learning styles.">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f5f5f5; }
    #root { width: 100%; height: 100vh; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .loading { display: flex; align-items: center; justify-content: center; height: 100vh; font-size: 18px; color: #666; }
  </style>
</head>
<body>
  <div id="root"><div class="loading">Loading demo...</div></div>
  
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  
  <script>
    function initApp() {
      if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
        setTimeout(initApp, 100);
        return;
      }
      
      const e = React.createElement;
      const useState = React.useState;
      const useEffect = React.useEffect;

      const colors = {
        bgPrimary: '#FAF9F7', bgSidebar: '#F5F4F0', textPrimary: '#1A1915',
        textSecondary: '#6B6760', textMuted: '#9B9690', accent: '#D97757',
        borderLight: '#E8E6E1', borderMedium: '#D4D2CD', userBubble: '#F0EFEB',
        blue: '#3B82F6', purple: '#8B5CF6', green: '#22C55E'
      };

      // Icons
      const Icons = {
        Claude: ({size = 20}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none'},
          e('path', {d: 'M12 2L13.09 8.26L18 6L14.74 10.91L21 12L14.74 13.09L18 18L13.09 15.74L12 22L10.91 15.74L6 18L9.26 13.09L3 12L9.26 10.91L6 6L10.91 8.26L12 2Z', fill: colors.accent})
        ),
        Send: ({size = 16, color = '#fff'}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth: 2},
          e('line', {x1: 22, y1: 2, x2: 11, y2: 13}), e('polygon', {points: '22 2 15 22 11 13 2 9 22 2'})
        ),
        Plus: ({size = 15}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('line', {x1: 12, y1: 5, x2: 12, y2: 19}), e('line', {x1: 5, y1: 12, x2: 19, y2: 12})
        ),
        Zap: ({size = 16, color}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth: 2},
          e('polygon', {points: '13 2 3 14 12 14 11 22 21 10 12 10 13 2'})
        ),
        Layers: ({size = 12}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('polygon', {points: '12 2 2 7 12 12 22 7 12 2'}), e('polyline', {points: '2 17 12 22 22 17'}), e('polyline', {points: '2 12 12 17 22 12'})
        ),
        Info: ({size = 12}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('circle', {cx: 12, cy: 12, r: 10}), e('line', {x1: 12, y1: 16, x2: 12, y2: 12}), e('line', {x1: 12, y1: 8, x2: 12.01, y2: 8})
        ),
        ChevronRight: ({size = 12}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('polyline', {points: '9 18 15 12 9 6'})
        ),
        ChevronDown: ({size = 12}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('polyline', {points: '6 9 12 15 18 9'})
        ),
        Lightbulb: ({size = 18}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('path', {d: 'M9 18h6'}), e('path', {d: 'M10 22h4'}), e('path', {d: 'M12 2a7 7 0 0 0-4 12.7V17h8v-2.3A7 7 0 0 0 12 2z'})
        ),
        ArrowRight: ({size = 10}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('line', {x1: 5, y1: 12, x2: 19, y2: 12}), e('polyline', {points: '12 5 19 12 12 19'})
        ),
        Compass: ({size = 10}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('circle', {cx: 12, cy: 12, r: 10}), e('polygon', {points: '16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76'})
        ),
        ArrowUpRight: ({size = 10}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('line', {x1: 7, y1: 17, x2: 17, y2: 7}), e('polyline', {points: '7 7 17 7 17 17'})
        ),
        Image: ({size = 10}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('rect', {x: 3, y: 3, width: 18, height: 18, rx: 2}), e('circle', {cx: 8.5, cy: 8.5, r: 1.5}), e('polyline', {points: '21 15 16 10 5 21'})
        ),
        FileText: ({size = 10}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('path', {d: 'M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z'}), e('polyline', {points: '14 2 14 8 20 8'}), e('line', {x1: 16, y1: 13, x2: 8, y2: 13}), e('line', {x1: 16, y1: 17, x2: 8, y2: 17})
        ),
        Code: ({size = 10}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('polyline', {points: '16 18 22 12 16 6'}), e('polyline', {points: '8 6 2 12 8 18'})
        ),
        X: ({size = 14}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('line', {x1: 18, y1: 6, x2: 6, y2: 18}), e('line', {x1: 6, y1: 6, x2: 18, y2: 18})
        ),
        Trophy: ({size = 28, color = '#fff'}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: color, strokeWidth: 2},
          e('path', {d: 'M6 9H4.5a2.5 2.5 0 0 1 0-5H6'}), e('path', {d: 'M18 9h1.5a2.5 2.5 0 0 0 0-5H18'}), e('path', {d: 'M4 22h16'}), e('path', {d: 'M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22'}), e('path', {d: 'M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22'}), e('path', {d: 'M18 2H6v7a6 6 0 0 0 12 0V2Z'})
        ),
        RotateCcw: ({size = 12}) => e('svg', {width: size, height: size, viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2},
          e('path', {d: 'M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8'}), e('path', {d: 'M3 3v5h5'})
        ),
        // Stage icons for Maya's diagram
        MessageBubble: () => e('svg', {width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'white', strokeWidth: 2},
          e('path', {d: 'M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z'})
        ),
        TextSplit: () => e('svg', {width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'white', strokeWidth: 2},
          e('path', {d: 'M4 7V4h16v3'}), e('path', {d: 'M9 20h6'}), e('path', {d: 'M12 4v16'})
        ),
        Network: () => e('svg', {width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'white', strokeWidth: 2},
          e('circle', {cx: 12, cy: 12, r: 3}), e('circle', {cx: 19, cy: 5, r: 2}), e('circle', {cx: 5, cy: 5, r: 2}), e('circle', {cx: 19, cy: 19, r: 2}), e('circle', {cx: 5, cy: 19, r: 2}),
          e('line', {x1: 12, y1: 9, x2: 12, y2: 5}), e('line', {x1: 14.5, y1: 13.5, x2: 17, y2: 17}), e('line', {x1: 9.5, y1: 13.5, x2: 7, y2: 17})
        ),
        Grid: () => e('svg', {width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'white', strokeWidth: 2},
          e('rect', {x: 3, y: 3, width: 18, height: 18, rx: 2}), e('path', {d: 'M3 9h18'}), e('path', {d: 'M3 15h18'}), e('path', {d: 'M9 3v18'}), e('path', {d: 'M15 3v18'})
        ),
        Chart: () => e('svg', {width: 18, height: 18, viewBox: '0 0 24 24', fill: 'none', stroke: 'white', strokeWidth: 2},
          e('polyline', {points: '22 7 13.5 15.5 8.5 10.5 2 17'}), e('polyline', {points: '16 7 22 7 22 13'})
        )
      };

      function FeasibilityBadge({level, glow = true}) {
        const [showTip, setShowTip] = useState(false);
        const configs = {
          now: { label: 'Buildable now', color: colors.green, tooltip: "Can be implemented today using Claude's existing memory system and system prompts. No new infrastructure required." },
          near: { label: 'Near-term', color: colors.blue, tooltip: 'Achievable with current artifact capabilities plus some UI/frontend work. Could be built within a few months.' },
          future: { label: 'Future vision', color: colors.purple, tooltip: 'Requires new client-side infrastructure and deeper platform integration. Longer-term roadmap item.' }
        };
        const c = configs[level];
        return e('span', {
          style: {position: 'relative', display: 'inline-flex', zIndex: 100},
          onMouseEnter: () => setShowTip(true), onMouseLeave: () => setShowTip(false)
        },
          e('span', {style: {fontSize: 9, fontWeight: 600, padding: '3px 7px', borderRadius: 4, backgroundColor: '#fff', color: c.color, textTransform: 'uppercase', letterSpacing: '0.3px', cursor: 'help', border: '2px solid ' + c.color, boxShadow: glow ? '0 0 12px ' + c.color + '60' : 'none'}}, c.label),
          showTip && e('span', {style: {position: 'absolute', bottom: '100%', left: '50%', transform: 'translateX(-50%)', marginBottom: 8, padding: '10px 12px', backgroundColor: '#1a1a1a', color: '#fff', fontSize: 11, lineHeight: 1.5, borderRadius: 8, width: 220, textAlign: 'left', zIndex: 1000, boxShadow: '0 4px 12px rgba(0,0,0,0.3)'}},
            e('span', {style: {fontWeight: 600, color: c.color, display: 'block', marginBottom: 4}}, c.label), c.tooltip,
            e('span', {style: {position: 'absolute', top: '100%', left: '50%', transform: 'translateX(-50%)', border: '6px solid transparent', borderTopColor: '#1a1a1a'}})
          )
        );
      }

      function Beacons({drillDown = [], sideways = [], broaden = [], onSelect}) {
        const items = [
          ...drillDown.map(t => ({text: t, color: colors.blue, icon: e(Icons.ArrowRight, {size: 10})})),
          ...sideways.map(t => ({text: t, color: colors.purple, icon: e(Icons.Compass, {size: 10})})),
          ...broaden.map(t => ({text: t, color: colors.green, icon: e(Icons.ArrowUpRight, {size: 10})}))
        ];
        if (!items.length) return null;
        return e('div', {style: {marginTop: 16, padding: 14, backgroundColor: colors.bgSidebar, borderRadius: 12, border: '1px solid ' + colors.borderLight}},
          e('div', {style: {fontSize: 11, fontWeight: 600, color: colors.textMuted, textTransform: 'uppercase', letterSpacing: 0.5, marginBottom: 10}}, 'Continue exploring'),
          e('div', {style: {display: 'flex', gap: 8, flexWrap: 'wrap'}},
            items.map((item, i) => e('button', {
              key: i, onClick: () => onSelect(item.text),
              style: {display: 'flex', alignItems: 'center', gap: 5, padding: '6px 12px', backgroundColor: '#fff', border: '1px solid ' + item.color + '40', borderRadius: 20, cursor: 'pointer', fontSize: 12, color: colors.textPrimary, fontFamily: 'inherit', transition: 'all 0.15s'},
              onMouseOver: function(ev) { ev.currentTarget.style.backgroundColor = item.color + '10'; ev.currentTarget.style.borderColor = item.color; },
              onMouseOut: function(ev) { ev.currentTarget.style.backgroundColor = '#fff'; ev.currentTarget.style.borderColor = item.color + '40'; }
            }, e('span', {style: {color: item.color}}, item.icon), item.text))
          )
        );
      }

      function WelcomeScreen({onSelectPrompt, persona}) {
        const names = {maya: 'Maya', james: 'James', alex: 'Alex'};
        const greetings = {maya: 'Ready to visualize something?', james: 'Ready to explore ideas in depth?', alex: 'Ready to build something?'};
        return e('div', {style: {display: 'flex', flexDirection: 'column', alignItems: 'center', padding: 32}},
          e(Icons.Claude, {size: 48}),
          e('h1', {style: {fontSize: 28, fontWeight: 600, color: colors.textPrimary, marginTop: 16, marginBottom: 8}}, 'Good afternoon, ' + names[persona]),
          e('p', {style: {fontSize: 16, color: colors.textSecondary, maxWidth: 400, textAlign: 'center', marginBottom: 32}}, greetings[persona]),
          e('button', {
            onClick: () => onSelectPrompt('Explain how large language models work'),
            style: {display: 'flex', alignItems: 'center', gap: 12, padding: 16, backgroundColor: '#fff', border: '1px solid ' + colors.borderLight, borderRadius: 12, cursor: 'pointer', textAlign: 'left', fontFamily: 'inherit', maxWidth: 300, transition: 'all 0.15s'},
            onMouseOver: function(ev) { ev.currentTarget.style.borderColor = colors.accent; ev.currentTarget.style.boxShadow = '0 2px 8px rgba(0,0,0,0.08)'; },
            onMouseOut: function(ev) { ev.currentTarget.style.borderColor = colors.borderLight; ev.currentTarget.style.boxShadow = 'none'; }
          },
            e('div', {style: {color: colors.accent}}, e(Icons.Lightbulb, {size: 18})),
            e('div', null,
              e('div', {style: {fontSize: 10, fontWeight: 600, color: colors.textMuted, textTransform: 'uppercase'}}, 'Learn'),
              e('div', {style: {fontSize: 14, color: colors.textPrimary, marginTop: 4}}, 'Explain how large language models work')
            )
          )
        );
      }

      function InputBar({persona, onSend, value, setValue}) {
        const placeholders = {maya: 'Describe what you want to visualize...', james: 'What would you like to explore?', alex: 'What do you want to build?'};
        return e('div', {style: {padding: '12px 24px 16px', borderTop: '1px solid ' + colors.borderLight, backgroundColor: colors.bgPrimary}},
          e('div', {style: {display: 'flex', alignItems: 'center', gap: 12, backgroundColor: '#fff', border: '1px solid ' + colors.borderMedium, borderRadius: 24, padding: '8px 8px 8px 20px'}},
            e('input', {type: 'text', value: value, onChange: function(ev) { setValue(ev.target.value); }, placeholder: placeholders[persona], style: {flex: 1, border: 'none', outline: 'none', fontSize: 15, color: colors.textPrimary, backgroundColor: 'transparent', fontFamily: 'inherit'}, onKeyDown: function(ev) { if (ev.key === 'Enter' && value.trim()) onSend(value); }}),
            e('button', {onClick: function() { if (value.trim()) onSend(value); }, style: {width: 36, height: 36, borderRadius: '50%', border: 'none', backgroundColor: value.trim() ? colors.accent : colors.borderLight, display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer'}},
              e(Icons.Send, {size: 16, color: value.trim() ? '#fff' : colors.textMuted})
            )
          )
        );
      }

      function ResponseHeader({persona, showReasoning, onToggle, showMvp}) {
        const reasoning = {
          maya: {
            short: 'Visual learner â†’ Interactive diagram',
            memory: 'Prefers diagrams, infographics, and visual explanations. Learns best when information is color-coded and spatially organized.',
            rule: 'if (user.learningStyle === "visual") {\n  response.format = "interactive-diagram";\n  response.features = ["color-coding", "hover-states"];\n}'
          },
          james: {
            short: 'Deep reader â†’ Structured prose',
            memory: 'Prefers comprehensive written explanations with proper structure. Values depth, nuance, and being able to explore terminology.',
            rule: 'if (user.learningStyle === "reading") {\n  response.format = "structured-prose";\n  response.features = ["glossary", "sections"];\n}'
          },
          alex: {
            short: 'Hands-on â†’ Step-by-step tutorial',
            memory: 'Learns by doing. Prefers interactive tutorials where they can experiment and see immediate results.',
            rule: 'if (user.learningStyle === "kinesthetic") {\n  response.format = "interactive-tutorial";\n  response.features = ["live-input", "progress"];\n}'
          }
        };
        const r = reasoning[persona];
        return e('div', {style: {marginBottom: 16}},
          e('div', {style: {display: 'flex', alignItems: 'center', gap: 8, marginBottom: showReasoning ? 12 : 0, flexWrap: 'wrap'}},
            e('span', {style: {fontSize: 12, fontWeight: 500, color: colors.textSecondary}}, 'Claude'),
            e('button', {onClick: onToggle, style: {display: 'flex', alignItems: 'center', gap: 4, padding: '3px 8px', backgroundColor: showReasoning ? colors.purple + '15' : 'transparent', border: '1px solid ' + (showReasoning ? colors.purple : colors.borderLight), borderRadius: 12, cursor: 'pointer', fontFamily: 'inherit', fontSize: 11, color: showReasoning ? colors.purple : colors.textMuted}},
              e(Icons.Info, {size: 12}), ' Why this format?', showReasoning ? e(Icons.ChevronDown, {size: 12}) : e(Icons.ChevronRight, {size: 12})
            ),
            !showReasoning && e('span', {style: {fontSize: 11, color: colors.textMuted, fontStyle: 'italic'}}, r.short),
            showMvp && !showReasoning && e(FeasibilityBadge, {level: 'now'})
          ),
          showReasoning && e('div', {style: {backgroundColor: colors.bgSidebar, borderRadius: 12, padding: 16, border: '1px solid ' + colors.borderLight}},
            e('div', {style: {marginBottom: 14}},
              e('div', {style: {display: 'flex', alignItems: 'center', gap: 6, marginBottom: 6}},
                e('div', {style: {width: 6, height: 6, borderRadius: '50%', backgroundColor: colors.accent}}),
                e('span', {style: {fontSize: 11, fontWeight: 600, color: colors.textSecondary, textTransform: 'uppercase', letterSpacing: 0.5}}, "Claude's Memory"),
                showMvp && e(FeasibilityBadge, {level: 'now'})
              ),
              e('p', {style: {margin: 0, fontSize: 13, color: colors.textPrimary, lineHeight: 1.5, paddingLeft: 12}}, r.memory)
            ),
            e('div', null,
              e('div', {style: {display: 'flex', alignItems: 'center', gap: 6, marginBottom: 6}},
                e('div', {style: {width: 6, height: 6, borderRadius: '50%', backgroundColor: colors.purple}}),
                e('span', {style: {fontSize: 11, fontWeight: 600, color: colors.textSecondary, textTransform: 'uppercase', letterSpacing: 0.5}}, 'UI Constitution Rule'),
                showMvp && e(FeasibilityBadge, {level: 'now'})
              ),
              e('pre', {style: {margin: 0, fontSize: 11, color: '#E8E6E1', backgroundColor: '#2D2D2D', padding: 12, borderRadius: 8, overflow: 'auto', lineHeight: 1.5}}, r.rule)
            )
          )
        );
      }

      // MAYA RESPONSE - Visual with SVG icons
      function MayaResponse({onFollowUp, showMvp}) {
        const [active, setActive] = useState(null);
        const [modal, setModal] = useState(null);
        
        const stages = [
          {id: 'input', label: 'Input', color: colors.blue, short: 'Text arrives as characters', icon: Icons.MessageBubble,
            full: 'Your message arrives as a sequence of Unicode characters. Before any AI processing can happen, this raw text needs to be converted into numerical representations. "Hello" becomes [72, 101, 108, 108, 111].'},
          {id: 'tokenize', label: 'Tokenize', color: colors.purple, short: 'Text splits into tokens', icon: Icons.TextSplit,
            full: 'Tokenization breaks text into subword units using Byte-Pair Encoding (BPE). Rather than whole words: "understanding" â†’ ["under", "stand", "ing"]. This balances vocabulary size (~100K tokens) with handling any word.'},
          {id: 'embed', label: 'Embed', color: colors.purple, short: 'Tokens become vectors', icon: Icons.Network,
            full: 'Each token maps to a dense vector of 768-12,288 numbers called an embedding. These encode semantic meaning geometricallyâ€”"King" and "Queen" are closer in this space than "King" and "Banana".'},
          {id: 'attention', label: 'Attention', color: colors.purple, short: '96 layers learn relationships', icon: Icons.Grid,
            full: 'The transformer\'s core mechanism. Each of 96 layers contains attention heads that learn which words relate to which. "The cat sat on the mat"â€”the model learns "sat" relates to "cat" (who) and "mat" (where).'},
          {id: 'output', label: 'Output', color: colors.green, short: 'Model predicts next token', icon: Icons.Chart,
            full: 'The final layer converts representations into probabilities for every possible next token. Given "The capital of France is", output: "Paris" (73%), "the" (8%), "located" (4%). The chosen token is sampled from this distribution.'}
        ];

        return e('div', null,
          e('div', {style: {display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12}},
            e('p', {style: {margin: 0, color: colors.textSecondary}}, "Here's how your words flow through an LLM â€” tap any stage to explore:"),
            showMvp && e(FeasibilityBadge, {level: 'near'})
          ),
          e('div', {style: {background: 'linear-gradient(180deg, #FAFBFC, #F5F7FA)', borderRadius: 16, border: '1px solid #E5E7EB', padding: 20, marginBottom: 16, position: 'relative'}},
            e('div', {style: {position: 'absolute', inset: 0, backgroundImage: 'radial-gradient(#E5E7EB 1px, transparent 0)', backgroundSize: '16px 16px', opacity: 0.5, pointerEvents: 'none', borderRadius: 16}}),
            e('div', {style: {position: 'relative', display: 'flex', flexDirection: 'column', gap: 6}},
              stages.map(function(stage, i) {
                return e(React.Fragment, {key: stage.id},
                  e('div', {
                    onClick: function() { setActive(active === stage.id ? null : stage.id); },
                    style: {width: '100%', padding: '12px 14px', background: 'linear-gradient(135deg, ' + stage.color + '08, ' + stage.color + '15)', border: '2px solid ' + (active === stage.id ? stage.color : stage.color + '40'), borderRadius: 12, cursor: 'pointer', transition: 'all 0.2s', transform: active === stage.id ? 'scale(1.01)' : 'scale(1)', boxShadow: active === stage.id ? '0 4px 12px ' + stage.color + '25' : 'none'}
                  },
                    e('div', {style: {display: 'flex', alignItems: 'center', gap: 10, flexWrap: 'wrap'}},
                      e('div', {style: {width: 36, height: 36, borderRadius: 10, background: 'linear-gradient(135deg, ' + stage.color + ', ' + stage.color + 'dd)', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0, boxShadow: '0 2px 8px ' + stage.color + '40'}},
                        e(stage.icon)
                      ),
                      e('div', {style: {flex: '1 1 120px', minWidth: 0}},
                        e('div', {style: {fontSize: 12, fontWeight: 600, color: stage.color, textTransform: 'uppercase', letterSpacing: '0.3px'}}, stage.label),
                        e('div', {style: {fontSize: 12, color: colors.textSecondary}}, stage.short)
                      ),
                      active === stage.id && e('button', {
                        onClick: function(ev) { ev.stopPropagation(); setModal(stage.id); },
                        style: {padding: '5px 12px', backgroundColor: stage.color, color: '#fff', border: 'none', borderRadius: 6, fontSize: 11, fontWeight: 500, cursor: 'pointer', whiteSpace: 'nowrap'}
                      }, 'Learn more â†’')
                    )
                  ),
                  i < stages.length - 1 && e('div', {style: {display: 'flex', justifyContent: 'center'}},
                    e('div', {style: {width: 2, height: 16, background: 'linear-gradient(to bottom, ' + stage.color + '60, ' + stages[i+1].color + '60)'}})
                  )
                );
              })
            ),
            e('div', {style: {display: 'flex', justifyContent: 'center', gap: 20, marginTop: 16, paddingTop: 14, borderTop: '1px solid #E5E7EB', flexWrap: 'wrap', position: 'relative'}},
              [{c: colors.blue, l: 'Input'}, {c: colors.purple, l: 'Processing'}, {c: colors.green, l: 'Output'}].map(function(x, i) {
                return e('div', {key: i, style: {display: 'flex', alignItems: 'center', gap: 6}},
                  e('div', {style: {width: 10, height: 10, borderRadius: '50%', backgroundColor: x.c, boxShadow: '0 0 6px ' + x.c + '50'}}),
                  e('span', {style: {fontSize: 11, color: colors.textMuted, fontWeight: 500}}, x.l)
                );
              })
            )
          ),
          e(Beacons, {
            drillDown: ['Attention mechanism deep-dive', 'How embeddings capture meaning'],
            sideways: ['How does this compare to human cognition?'],
            broaden: ['Future of AI'],
            onSelect: onFollowUp
          }),
          modal && e('div', {
            onClick: function() { setModal(null); },
            style: {position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, padding: 16}
          },
            e('div', {
              onClick: function(ev) { ev.stopPropagation(); },
              style: {background: '#fff', borderRadius: 16, padding: 24, maxWidth: 400, width: '100%'}
            },
              e('div', {style: {display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12}},
                e('div', {style: {display: 'flex', alignItems: 'center', gap: 10}},
                  e('div', {style: {width: 32, height: 32, borderRadius: 8, backgroundColor: stages.find(function(s) { return s.id === modal; }).color, display: 'flex', alignItems: 'center', justifyContent: 'center'}},
                    e(stages.find(function(s) { return s.id === modal; }).icon)
                  ),
                  e('h3', {style: {margin: 0, fontSize: 16, color: colors.textPrimary}}, stages.find(function(s) { return s.id === modal; }).label)
                ),
                e('button', {onClick: function() { setModal(null); }, style: {background: 'none', border: 'none', cursor: 'pointer', padding: 4}}, e(Icons.X, {size: 18, color: colors.textMuted}))
              ),
              e('p', {style: {margin: 0, color: colors.textSecondary, lineHeight: 1.7}}, stages.find(function(s) { return s.id === modal; }).full)
            )
          )
        );
      }

      // JAMES RESPONSE - Full interactive glossary
      function JamesResponse({onFollowUp, showMvp}) {
        const [expanded, setExpanded] = useState(null);
        
        const glossary = {
          tokens: {title: 'Tokens', def: "The atomic units that LLMs process. Rather than whole words, models use subword unitsâ€”\"understanding\" might become [\"under\", \"stand\", \"ing\"]. GPT-4 uses approximately 100,000 unique tokens. This balances vocabulary size with handling novel words."},
          transformer: {title: 'Transformer', def: "The neural network architecture from 2017's \"Attention Is All You Need\" paper. Its key innovation was replacing sequential processing with parallel self-attention, allowing models to consider all parts of input simultaneously. This underlies GPT, Claude, and all modern LLMs."},
          attention: {title: 'Attention', def: "The mechanism allowing models to weigh importance of different tokens dynamically. In self-attention, each position can \"attend to\" every other position, learning contextual relationships. Multi-head attention runs several operations in parallel, capturing different relationship types."},
          parameters: {title: 'Parameters', def: "The learned numerical weights in a neural networkâ€”essentially the model's \"knowledge\" encoded as numbers. GPT-4 reportedly has ~1.76 trillion parameters. More parameters generally enable more nuanced understanding, but require more computation."},
          embedding: {title: 'Embedding', def: "A dense vector representation of a token in high-dimensional space (typically 768-12,288 dimensions). Similar concepts cluster togetherâ€”\"king\" and \"queen\" are closer than \"king\" and \"bicycle\". These geometric relationships enable semantic reasoning."}
        };
        
        function Term({id, children}) {
          return e('span', {style: {position: 'relative', display: 'inline'}},
            e('button', {
              onClick: function() { setExpanded(expanded === id ? null : id); },
              style: {background: expanded === id ? colors.accent + '20' : 'transparent', border: 'none', borderBottom: '2px dotted ' + colors.accent, color: 'inherit', cursor: 'pointer', fontFamily: 'inherit', fontSize: 'inherit', padding: '0 2px'}
            }, children, e('span', {style: {marginLeft: 2, fontSize: 10, opacity: 0.6}}, 'â†—')),
            expanded === id && glossary[id] && e('div', {style: {position: 'absolute', left: 0, top: '100%', marginTop: 8, width: 280, background: '#fff', borderRadius: 10, padding: 12, boxShadow: '0 8px 24px rgba(0,0,0,0.15)', border: '1px solid ' + colors.borderLight, zIndex: 100}},
              e('div', {style: {display: 'flex', justifyContent: 'space-between', marginBottom: 6}},
                e('h4', {style: {margin: 0, fontSize: 13, fontWeight: 600, color: colors.accent}}, glossary[id].title),
                e('button', {onClick: function() { setExpanded(null); }, style: {background: 'none', border: 'none', cursor: 'pointer', padding: 0}}, e(Icons.X, {size: 14}))
              ),
              e('p', {style: {margin: 0, fontSize: 12, color: colors.textSecondary, lineHeight: 1.6}}, glossary[id].def)
            )
          );
        }

        return e('div', {onClick: function() { if (expanded) setExpanded(null); }},
          e('p', {style: {marginBottom: 16, color: colors.textPrimary, lineHeight: 1.8}},
            'Large Language Models represent a fundamental shift in how we approach artificial intelligence. Rather than programming explicit rules, we train neural networks on vast text corpora to predict and generate language. Here\'s a systematic breakdown.'
          ),
          e('div', {style: {display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12}},
            e('span', {style: {color: colors.accent, fontSize: 12, fontWeight: 600}}, 'ðŸ’¡ Click underlined terms to explore definitions'),
            showMvp && e(FeasibilityBadge, {level: 'near'})
          ),
          e('h3', {style: {fontSize: 14, fontWeight: 600, color: colors.textPrimary, marginBottom: 8, marginTop: 20}}, '1. The Core Architecture'),
          e('p', {style: {marginBottom: 16, color: colors.textPrimary, lineHeight: 1.8}},
            'Modern LLMs are built on the ', e(Term, {id: 'transformer'}, 'transformer'), ' architecture. Unlike earlier recurrent models that processed text sequentially, transformers use ', e(Term, {id: 'attention'}, 'attention mechanisms'), ' to process all ', e(Term, {id: 'tokens'}, 'tokens'), ' in parallel, dramatically improving both training speed and the ability to capture long-range dependencies.'
          ),
          e('h3', {style: {fontSize: 14, fontWeight: 600, color: colors.textPrimary, marginBottom: 8, marginTop: 20}}, '2. From Text to Numbers'),
          e('p', {style: {marginBottom: 16, color: colors.textPrimary, lineHeight: 1.8}},
            'Before processing, text is converted to numerical representations. Each token maps to an ', e(Term, {id: 'embedding'}, 'embedding'), 'â€”a high-dimensional vector where semantic relationships are encoded geometrically. Words with similar meanings cluster together in this space.'
          ),
          e('h3', {style: {fontSize: 14, fontWeight: 600, color: colors.textPrimary, marginBottom: 8, marginTop: 20}}, '3. Scale and Capability'),
          e('p', {style: {marginBottom: 16, color: colors.textPrimary, lineHeight: 1.8}},
            'Modern LLMs contain billions of ', e(Term, {id: 'parameters'}, 'parameters'), '. This scale, combined with training on trillions of tokens, enables emergent capabilitiesâ€”behaviors that arise from scale rather than explicit programming.'
          ),
          e('div', {style: {borderLeft: '3px solid ' + colors.accent, backgroundColor: colors.accent + '08', padding: '14px 18px', borderRadius: '0 8px 8px 0', marginBottom: 16}},
            e('p', {style: {margin: 0, fontStyle: 'italic', color: colors.textSecondary, lineHeight: 1.6}},
              e('strong', {style: {color: colors.textPrimary}}, 'Key insight: '),
              "LLMs are fundamentally sophisticated pattern matchers, not reasoning engines. They predict likely continuations based on statistical patterns in training data, which can produce remarkably coherent outputsâ€”but also confident-sounding errors."
            )
          ),
          e(Beacons, {
            drillDown: ['Explain attention in depth', 'How is training done?'],
            sideways: ["What can't LLMs do?"],
            broaden: ['Future directions in AI'],
            onSelect: onFollowUp
          })
        );
      }

      // ALEX RESPONSE - 5 steps + completion
      function AlexResponse({onFollowUp, showMvp}) {
        const [input, setInput] = useState('');
        const [step, setStep] = useState(1);
        const [completed, setCompleted] = useState([]);
        const [showComplete, setShowComplete] = useState(false);
        
        var tokens = input ? input.split(/(\s+|'|,|\.|\!)/).filter(function(x) { return x.trim(); }) : [];
        var steps = [{n: 1, t: 'Input'}, {n: 2, t: 'Tokenize'}, {n: 3, t: 'Embed'}, {n: 4, t: 'Process'}, {n: 5, t: 'Output'}];
        
        function next() {
          if (step < 5) {
            setCompleted(completed.concat([step]));
            setStep(step + 1);
          } else {
            setShowComplete(true);
          }
        }
        function back() {
          if (step > 1) {
            setCompleted(completed.filter(function(s) { return s !== step - 1; }));
            setStep(step - 1);
          }
        }
        function reset() {
          setStep(1);
          setCompleted([]);
          setInput('');
          setShowComplete(false);
        }

        if (showComplete) {
          return e('div', null,
            e('div', {style: {textAlign: 'center', padding: 32, backgroundColor: colors.green + '08', borderRadius: 16, border: '1px solid ' + colors.green + '30', marginBottom: 20}},
              e('div', {style: {width: 56, height: 56, borderRadius: '50%', backgroundColor: colors.green, display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 16px'}},
                e(Icons.Trophy, {size: 28, color: '#fff'})
              ),
              e('h3', {style: {margin: '0 0 8px', fontSize: 18, color: colors.textPrimary}}, 'Tutorial Complete! ðŸŽ‰'),
              e('p', {style: {margin: '0 0 20px', color: colors.textSecondary}}, 'You traced the full LLM pipeline from input to output!'),
              e('div', {style: {display: 'flex', gap: 12, justifyContent: 'center', flexWrap: 'wrap'}},
                e('button', {onClick: reset, style: {display: 'flex', alignItems: 'center', gap: 6, padding: '10px 20px', backgroundColor: '#fff', border: '1px solid ' + colors.borderLight, borderRadius: 8, cursor: 'pointer', fontFamily: 'inherit', fontSize: 14, color: colors.textPrimary}},
                  e(Icons.RotateCcw, {size: 14}), 'Try again'
                ),
                e('button', {onClick: function() { onFollowUp('Build a transformer'); }, style: {display: 'flex', alignItems: 'center', gap: 6, padding: '10px 20px', backgroundColor: colors.accent, border: 'none', borderRadius: 8, cursor: 'pointer', fontFamily: 'inherit', fontSize: 14, color: '#fff', fontWeight: 500}},
                  e(Icons.Code, {size: 14}), 'Build one'
                )
              )
            ),
            e(Beacons, {
              drillDown: ['Build a minimal transformer', 'Implement attention from scratch'],
              sideways: ['How does fine-tuning work?', 'What is RLHF?'],
              onSelect: onFollowUp
            })
          );
        }

        return e('div', null,
          e('div', {style: {display: 'flex', alignItems: 'center', gap: 8, marginBottom: 16}},
            e('p', {style: {margin: 0, color: colors.textPrimary, lineHeight: 1.7}}, "Let's learn by doing. Complete each step to trace how text flows through an LLM."),
            showMvp && e(FeasibilityBadge, {level: 'near'})
          ),
          e('div', {style: {display: 'flex', alignItems: 'center', gap: 2, marginBottom: 16, overflowX: 'auto', paddingBottom: 4}},
            steps.map(function(s, i) {
              return e(React.Fragment, {key: s.n},
                e('button', {
                  onClick: function() { setStep(s.n); },
                  style: {display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 3, padding: '6px 8px', borderRadius: 8, border: 'none', background: step === s.n ? colors.accent + '15' : 'transparent', cursor: 'pointer', minWidth: 48, flexShrink: 0}
                },
                  e('div', {style: {width: 22, height: 22, borderRadius: '50%', background: completed.indexOf(s.n) > -1 ? colors.green : step === s.n ? colors.accent : colors.borderLight, color: completed.indexOf(s.n) > -1 || step === s.n ? '#fff' : colors.textMuted, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 10, fontWeight: 600}},
                    completed.indexOf(s.n) > -1 ? 'âœ“' : s.n
                  ),
                  e('div', {style: {fontSize: 9, fontWeight: step === s.n ? 600 : 400, color: step === s.n ? colors.accent : colors.textMuted}}, s.t)
                ),
                i < 4 && e('div', {style: {width: 12, height: 2, background: completed.indexOf(s.n) > -1 ? colors.green : colors.borderLight, flexShrink: 0}})
              );
            })
          ),
          e('div', {style: {backgroundColor: '#fff', borderRadius: 12, border: '1px solid ' + colors.borderLight, padding: 16, marginBottom: 12}},
            step === 1 && e('div', null,
              e('h4', {style: {margin: '0 0 8px', fontSize: 14, color: colors.textPrimary}}, 'Step 1: Enter Your Text'),
              e('p', {style: {margin: '0 0 12px', fontSize: 13, color: colors.textSecondary}}, 'Type anything to trace through the pipeline.'),
              e('input', {type: 'text', value: input, onChange: function(ev) { setInput(ev.target.value); }, placeholder: 'e.g., Hello world!', style: {width: '100%', padding: '10px 12px', fontSize: 14, border: '2px solid ' + colors.borderLight, borderRadius: 8, outline: 'none', boxSizing: 'border-box', fontFamily: 'inherit'}}),
              e('p', {style: {margin: '8px 0 0', fontSize: 11, color: colors.textMuted}}, input ? input.length + ' characters â†’ ready to process' : 'Type something to begin...')
            ),
            step === 2 && e('div', null,
              e('h4', {style: {margin: '0 0 8px', fontSize: 14, color: colors.textPrimary}}, 'Step 2: Tokenization'),
              e('p', {style: {margin: '0 0 12px', fontSize: 13, color: colors.textSecondary}}, 'Your text gets split into tokens (subword units).'),
              e('div', {style: {marginBottom: 12, padding: 10, background: colors.bgSidebar, borderRadius: 8}},
                e('div', {style: {fontSize: 11, color: colors.textMuted, marginBottom: 6}}, 'Your input:'),
                e('div', {style: {fontSize: 13, color: colors.textPrimary, wordBreak: 'break-word'}}, '"' + (input || 'Hello world!') + '"')
              ),
              e('div', {style: {fontSize: 11, color: colors.textMuted, marginBottom: 6}}, 'Splits into ' + (tokens.length || 2) + ' tokens:'),
              e('div', {style: {display: 'flex', gap: 6, flexWrap: 'wrap'}},
                (tokens.length ? tokens : ['Hello', 'world!']).map(function(t, i) {
                  return e('span', {key: i, style: {padding: '4px 10px', backgroundColor: colors.purple + '15', color: colors.purple, borderRadius: 6, fontSize: 12, fontFamily: 'monospace'}}, t);
                })
              )
            ),
            step === 3 && e('div', null,
              e('h4', {style: {margin: '0 0 8px', fontSize: 14, color: colors.textPrimary}}, 'Step 3: Embedding'),
              e('p', {style: {margin: '0 0 12px', fontSize: 13, color: colors.textSecondary}}, 'Each token becomes a 768-dimensional vector.'),
              e('div', {style: {display: 'flex', flexDirection: 'column', gap: 8}},
                (tokens.length ? tokens.slice(0, 3) : ['Hello', 'world']).map(function(t, i) {
                  return e('div', {key: i, style: {display: 'flex', alignItems: 'center', gap: 8, flexWrap: 'wrap'}},
                    e('span', {style: {padding: '3px 8px', backgroundColor: colors.purple + '15', color: colors.purple, borderRadius: 4, fontSize: 11, fontFamily: 'monospace', flexShrink: 0}}, t),
                    e('span', {style: {color: colors.textMuted}}, 'â†’'),
                    e('span', {style: {fontSize: 10, color: colors.textMuted, fontFamily: 'monospace', wordBreak: 'break-all'}}, '[' + [0,1,2,3,4].map(function() { return (Math.random() * 2 - 1).toFixed(3); }).join(', ') + '...]')
                  );
                })
              )
            ),
            step === 4 && e('div', null,
              e('h4', {style: {margin: '0 0 8px', fontSize: 14, color: colors.textPrimary}}, 'Step 4: Attention Layers'),
              e('p', {style: {margin: '0 0 12px', fontSize: 13, color: colors.textSecondary}}, '96 transformer layers learn which words relate to which.'),
              e('div', {style: {display: 'flex', gap: 6, flexWrap: 'wrap', justifyContent: 'center'}},
                [0,1,2,3,4,5,6,7,8,9,10,11].map(function(i) {
                  return e('div', {key: i, style: {width: 32, height: 32, borderRadius: 6, backgroundColor: i < 4 ? colors.accent : colors.borderLight, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 9, color: i < 4 ? '#fff' : colors.textMuted, fontWeight: 600}}, i + 1);
                }),
                e('div', {style: {width: 32, height: 32, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 12, color: colors.textMuted}}, '...')
              ),
              e('p', {style: {margin: '12px 0 0', fontSize: 11, color: colors.textMuted, textAlign: 'center'}}, 'Processing layer 4 of 96...')
            ),
            step === 5 && e('div', null,
              e('h4', {style: {margin: '0 0 8px', fontSize: 14, color: colors.textPrimary}}, 'Step 5: Prediction'),
              e('p', {style: {margin: '0 0 12px', fontSize: 13, color: colors.textSecondary}}, 'The model outputs probabilities for the next token.'),
              e('div', {style: {padding: 12, background: colors.green + '08', borderRadius: 8, border: '1px solid ' + colors.green + '30'}},
                e('div', {style: {fontSize: 11, color: colors.textMuted, marginBottom: 10, wordBreak: 'break-word'}}, 'After "' + (input || 'Hello') + '", most likely next tokens:'),
                [{w: 'world', p: 23}, {w: 'there', p: 18}, {w: '!', p: 15}].map(function(x, i) {
                  return e('div', {key: i, style: {display: 'flex', alignItems: 'center', gap: 6, marginTop: 6}},
                    e('span', {style: {fontSize: 12, width: 50, fontFamily: 'monospace', flexShrink: 0}}, x.w),
                    e('div', {style: {flex: 1, height: 6, background: colors.green + '20', borderRadius: 3, overflow: 'hidden', minWidth: 40}},
                      e('div', {style: {width: x.p * 2.5 + '%', height: '100%', background: colors.green, borderRadius: 3}})
                    ),
                    e('span', {style: {fontSize: 10, color: colors.green, fontWeight: 600, flexShrink: 0, width: 35, textAlign: 'right'}}, x.p + '%')
                  );
                })
              )
            )
          ),
          e('div', {style: {display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: 8}},
            e('button', {onClick: back, disabled: step === 1, style: {padding: '8px 12px', borderRadius: 6, border: '1px solid ' + colors.borderLight, background: step === 1 ? colors.bgSidebar : '#fff', color: step === 1 ? colors.textMuted : colors.textPrimary, cursor: step === 1 ? 'not-allowed' : 'pointer', fontFamily: 'inherit', fontSize: 12}}, 'â† Back'),
            e('button', {onClick: reset, style: {display: 'flex', alignItems: 'center', gap: 4, padding: '8px 10px', borderRadius: 6, border: 'none', background: 'transparent', color: colors.textMuted, cursor: 'pointer', fontFamily: 'inherit', fontSize: 11}},
              e(Icons.RotateCcw, {size: 12}), 'Reset'
            ),
            e('button', {onClick: next, disabled: step === 1 && !input.trim(), style: {display: 'flex', alignItems: 'center', gap: 4, padding: '8px 12px', borderRadius: 6, border: 'none', background: (step === 1 && !input.trim()) ? colors.borderLight : colors.accent, color: '#fff', cursor: (step === 1 && !input.trim()) ? 'not-allowed' : 'pointer', fontFamily: 'inherit', fontSize: 12, fontWeight: 500}},
              step === 5 ? 'Complete!' : 'Next', step < 5 && e(Icons.ArrowRight, {size: 12})
            )
          )
        );
      }

      // MAIN APP
      function App() {
        const [persona, setPersona] = useState('maya');
        const [view, setView] = useState('welcome');
        const [message, setMessage] = useState('');
        const [inputValue, setInputValue] = useState('');
        const [isLoading, setIsLoading] = useState(false);
        const [showReasoning, setShowReasoning] = useState(false);
        const [showMvp, setShowMvp] = useState(false);
        const [formatOverride, setFormatOverride] = useState(null);

        var personas = [{id: 'maya', name: 'Maya', style: 'Visual'}, {id: 'james', name: 'James', style: 'Reading'}, {id: 'alex', name: 'Alex', style: 'Hands-On'}];
        
        function selectPrompt(text) { setMessage(text); setIsLoading(true); setView('chat'); setFormatOverride(null); setTimeout(function() { setIsLoading(false); }, 1500); }
        function send(text) { setMessage(text); setInputValue(''); setIsLoading(true); setView('chat'); setTimeout(function() { setIsLoading(false); }, 1500); }
        function reset() { setView('welcome'); setMessage(''); setInputValue(''); setShowReasoning(false); setFormatOverride(null); }

        var effectiveFormat = formatOverride || (persona === 'maya' ? 'visual' : persona === 'alex' ? 'interactive' : 'text');

        return e('div', {style: {fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif', display: 'flex', height: '100vh', borderRadius: 12, overflow: 'hidden', border: '1px solid ' + colors.borderLight, boxShadow: '0 4px 24px rgba(0,0,0,0.08)', position: 'relative'}},
          
          showMvp && e('div', {onClick: function() { setShowMvp(false); }, style: {position: 'absolute', inset: 0, zIndex: 5, cursor: 'pointer'}}),
          
          // Sidebar
          e('div', {style: {width: 260, flexShrink: 0, display: 'flex', flexDirection: 'column', borderRight: '1px solid ' + colors.borderLight, backgroundColor: colors.bgSidebar, zIndex: 10}},
            e('div', {style: {padding: '14px 18px', display: 'flex', alignItems: 'center', gap: 8, borderBottom: '1px solid ' + colors.borderLight}},
              e(Icons.Claude, {size: 22}),
              e('span', {style: {fontSize: 17, fontWeight: 600, color: colors.textPrimary}}, 'Claude')
            ),
            e('div', {style: {padding: '10px 14px'}},
              e('button', {onClick: reset, style: {width: '100%', padding: '9px 14px', backgroundColor: colors.bgPrimary, border: '1px solid ' + colors.borderLight, borderRadius: 8, display: 'flex', alignItems: 'center', gap: 7, cursor: 'pointer', fontSize: 13, color: colors.textPrimary, fontFamily: 'inherit'}},
                e(Icons.Plus, {size: 15}), 'New chat'
              )
            ),
            e('div', {style: {flex: 1}}),
            
            // Demo Controls
            e('div', {style: {margin: 14, padding: 14, backgroundColor: colors.bgPrimary, borderRadius: 10, border: '1px solid ' + colors.borderLight}},
              e('div', {style: {display: 'flex', alignItems: 'center', gap: 7, marginBottom: 10}},
                e(Icons.Zap, {size: 16, color: colors.accent}),
                e('span', {style: {fontSize: 12, fontWeight: 600, color: colors.textPrimary}}, 'Demo Mode')
              ),
              e('button', {
                onClick: function() { setShowMvp(!showMvp); },
                style: {width: '100%', padding: '8px 10px', marginBottom: 10, backgroundColor: showMvp ? colors.blue + '15' : 'transparent', border: '1px solid ' + (showMvp ? colors.blue : colors.borderLight), borderRadius: 6, cursor: 'pointer', fontSize: 11, color: showMvp ? colors.blue : colors.textSecondary, fontFamily: 'inherit', display: 'flex', alignItems: 'center', gap: 6}
              }, e(Icons.Layers, {size: 12}), (showMvp ? 'Hide' : 'Show') + ' feasibility'),
              e('div', {style: {fontSize: 11, color: colors.textSecondary, marginBottom: 8}}, 'Switch persona to see adaptive UI:'),
              e('div', {style: {display: 'flex', flexDirection: 'column', gap: 3}},
                personas.map(function(p) {
                  return e('button', {
                    key: p.id, onClick: function() { setPersona(p.id); setFormatOverride(null); },
                    style: {display: 'flex', alignItems: 'center', gap: 9, padding: '9px 10px', borderRadius: 7, border: 'none', backgroundColor: persona === p.id ? colors.accent + '15' : 'transparent', cursor: 'pointer', width: '100%', textAlign: 'left', fontFamily: 'inherit'}
                  },
                    e('div', {style: {width: 7, height: 7, borderRadius: '50%', border: '2px solid ' + (persona === p.id ? colors.accent : colors.borderMedium), backgroundColor: persona === p.id ? colors.accent : 'transparent'}}),
                    e('div', null,
                      e('div', {style: {fontSize: 12, fontWeight: persona === p.id ? 600 : 400, color: persona === p.id ? colors.accent : colors.textPrimary}}, p.name),
                      e('div', {style: {fontSize: 10, color: colors.textMuted}}, p.style)
                    )
                  );
                })
              )
            ),
            
            showMvp && e('div', {style: {margin: '0 14px 14px', padding: 12, backgroundColor: '#fff', borderRadius: 8, border: '1px solid ' + colors.borderLight}},
              e('div', {style: {fontSize: 10, fontWeight: 600, color: colors.textMuted, marginBottom: 8, textTransform: 'uppercase', letterSpacing: '0.3px'}}, 'Implementation Phases'),
              e('div', {style: {display: 'flex', flexDirection: 'column', gap: 6}},
                [{l: 'now', t: 'Memory + prompts'}, {l: 'near', t: 'Artifacts + UI'}, {l: 'future', t: 'New infra'}].map(function(x) {
                  return e('div', {key: x.l, style: {display: 'flex', alignItems: 'center', gap: 6}},
                    e(FeasibilityBadge, {level: x.l, glow: false}),
                    e('span', {style: {fontSize: 10, color: colors.textSecondary}}, x.t)
                  );
                })
              )
            )
          ),

          // Main content
          e('div', {style: {flex: 1, display: 'flex', flexDirection: 'column', backgroundColor: colors.bgPrimary, position: 'relative', zIndex: showMvp ? 6 : 1}},
            showMvp && e('div', {style: {position: 'absolute', inset: 0, backgroundColor: 'rgba(255,255,255,0.6)', zIndex: 8, pointerEvents: 'none'}}),
            
            view === 'welcome' ? e(React.Fragment, null,
              e('div', {style: {flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center'}},
                e(WelcomeScreen, {onSelectPrompt: selectPrompt, persona: persona})
              ),
              e(InputBar, {persona: persona, onSend: send, value: inputValue, setValue: setInputValue})
            ) : e(React.Fragment, null,
              e('div', {style: {flex: 1, overflow: 'auto', padding: '16px 24px'}},
                e('div', {style: {display: 'flex', justifyContent: 'flex-end', marginBottom: 20}},
                  e('div', {style: {maxWidth: '85%', backgroundColor: colors.userBubble, padding: '10px 14px', borderRadius: 14, fontSize: 13, color: colors.textPrimary}}, message)
                ),
                isLoading ? e('div', {style: {display: 'flex', gap: 10}},
                  e('div', {style: {width: 24, height: 24, borderRadius: '50%', backgroundColor: colors.accent + '15', display: 'flex', alignItems: 'center', justifyContent: 'center'}}, e(Icons.Claude, {size: 12})),
                  e('div', {style: {padding: 12, backgroundColor: colors.bgSidebar, borderRadius: 10, border: '1px solid ' + colors.borderLight}},
                    e('span', {style: {fontSize: 12, color: colors.accent, animation: 'pulse 1.5s infinite'}}, 'Thinking...')
                  )
                ) : e('div', {style: {display: 'flex', gap: 10}},
                  e('div', {style: {width: 24, height: 24, borderRadius: '50%', backgroundColor: colors.accent + '15', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0}}, e(Icons.Claude, {size: 12})),
                  e('div', {style: {flex: 1, minWidth: 0}},
                    e(ResponseHeader, {persona: persona, showReasoning: showReasoning, onToggle: function() { setShowReasoning(!showReasoning); }, showMvp: showMvp}),
                    
                    e('div', {style: {display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12, flexWrap: 'wrap'}},
                      e('span', {style: {fontSize: 11, color: colors.textMuted}}, 'Format:'),
                      [{id: 'visual', label: 'Visual', icon: e(Icons.Image, {size: 10})}, {id: 'text', label: 'Text', icon: e(Icons.FileText, {size: 10})}, {id: 'interactive', label: 'Interactive', icon: e(Icons.Code, {size: 10})}].map(function(f) {
                        return e('button', {
                          key: f.id,
                          onClick: function() { setFormatOverride(f.id === effectiveFormat && formatOverride ? null : f.id); },
                          style: {display: 'flex', alignItems: 'center', gap: 4, padding: '4px 10px', fontSize: 11, border: '1px solid ' + (effectiveFormat === f.id ? colors.accent : colors.borderLight), borderRadius: 12, backgroundColor: effectiveFormat === f.id ? colors.accent + '10' : '#fff', color: effectiveFormat === f.id ? colors.accent : colors.textSecondary, cursor: 'pointer', fontFamily: 'inherit'}
                        }, f.icon, ' ', f.label, effectiveFormat === f.id && !formatOverride ? e('span', {style: {fontSize: 9, opacity: 0.7}}, ' (auto)') : null);
                      }),
                      showMvp && e(FeasibilityBadge, {level: 'now'})
                    ),
                    
                    e('div', {style: {fontSize: 14, lineHeight: 1.7, color: colors.textPrimary}},
                      effectiveFormat === 'visual' && e(MayaResponse, {onFollowUp: function(t) { setInputValue(t); }, showMvp: showMvp}),
                      effectiveFormat === 'text' && e(JamesResponse, {onFollowUp: function(t) { setInputValue(t); }, showMvp: showMvp}),
                      effectiveFormat === 'interactive' && e(AlexResponse, {onFollowUp: function(t) { setInputValue(t); }, showMvp: showMvp})
                    )
                  )
                )
              ),
              e(InputBar, {persona: persona, onSend: send, value: inputValue, setValue: setInputValue})
            )
          )
        );
      }

      ReactDOM.render(e(App), document.getElementById('root'));
    }
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initApp);
    } else {
      initApp();
    }
  </script>
</body>
</html>
